---
import { cn } from '../../lib/utils';

interface Props {
	id?: string;
	title: string;
	subtitle?: string;
	class?: string;
}

const { id, title, subtitle, class: className } = Astro.props;
const hasAction = Astro.slots.has('action');
---

<section id={id} class={cn("py-16 md:py-20 lg:py-24 xl:py-28 section-animate", className)}>
  <div class="container-custom">
    <!-- Header -->
    <div class={cn("motion-header", hasAction ? "mb-12 md:mb-14 lg:mb-16 flex flex-col gap-5 md:gap-6 sm:flex-row sm:items-end sm:justify-between" : "mb-16 md:mb-18 lg:mb-20 text-center")}>
       <div class={hasAction ? "max-w-3xl" : "mx-auto max-w-3xl"}>
          <h2 class={cn("font-bold tracking-tight text-foreground", hasAction ? "mb-3 md:mb-4 text-2xl md:text-3xl lg:text-4xl" : "mb-5 md:mb-6 text-3xl md:text-4xl lg:text-5xl xl:text-6xl")}>
            {title}
          </h2>
          {subtitle && (
            <p class={cn("text-muted-foreground leading-relaxed", hasAction ? "text-base md:text-lg lg:text-xl text-pretty" : "text-lg md:text-xl lg:text-2xl mx-autotext-pretty")}>
               {subtitle}
            </p>
          )}
       </div>
       {hasAction && (
         <div class="shrink-0">
            <slot name="action" />
         </div>
       )}
    </div>

    <!-- Content -->
    <div class="motion-content">
       <slot />
    </div>
  </div>
</section>

<script>
  import { inView, animate } from "motion";
  
  // Check for reduced motion preference
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  
  // Observe all sections with optimized settings
  inView(".section-animate", (info: any) => {
      const target = info.target as HTMLElement;
      if (!target) return;
      
      const header = target.querySelector(".motion-header") as HTMLElement;
      const content = target.querySelector(".motion-content") as HTMLElement;
      
      if (prefersReducedMotion) {
        // Simple fade for reduced motion
        if (header) {
          animate(header as any, { opacity: [0, 1] }, { duration: 0.3 } as any);
        }
        if (content) {
          animate(content as any, { opacity: [0, 1] }, { duration: 0.3, delay: 0.05 } as any);
        }
      } else {
        // Full animation for normal motion
        if (header) {
          animate(header as any, { opacity: [0, 1], y: [30, 0] }, { duration: 0.7, easing: [0.16, 1, 0.3, 1] } as any);
        }
        if (content) {
          animate(content as any, { opacity: [0, 1], y: [24, 0] }, { duration: 0.7, delay: 0.15, easing: [0.16, 1, 0.3, 1] } as any);
        }
      }
  }, { margin: "0px 0px -100px 0px" });
</script>
