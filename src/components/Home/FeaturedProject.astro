---
import SanityImage from '../shared/SanityImage.astro';
import Button from '../ui/Button.astro';
import Chip from '../ui/Chip.astro';

interface Props {
	title: string;
	description: string;
	image: any;
	year?: string | number;
	technologies?: string[];
	githubRepo?: string;
	demoLink?: string;
}

const { title, description, image, year, technologies = [], githubRepo, demoLink } = Astro.props;
---

<section class="container mb-12 rounded-2xl border border-border/60 bg-card p-8 md:p-10 shadow-xl section-animate featured-project overflow-hidden">
  <div class="grid items-center gap-10 md:grid-cols-12">
    <div class="md:col-span-7 motion-image opacity-0 translate-y-4">
      <div class="relative aspect-video w-full overflow-hidden rounded-xl border border-border/60 bg-muted/30 shadow-lg">
        {typeof image === "object" && image?.asset ? (
          <SanityImage asset={image.asset} alt={title} class="h-full w-full object-cover transition-transform duration-700 hover:scale-105" />
        ) : (
           <div class="h-full w-full bg-muted flex items-center justify-center text-muted-foreground">No Image</div>
        )}
        <!-- Overlay gradient -->
        <div class="absolute inset-0 bg-linear-to-t from-background/40 via-transparent to-transparent pointer-events-none"></div>
      </div>
    </div>
    <div class="md:col-span-5 motion-text opacity-0 translate-y-4 space-y-6">
      <div>
        <h3 class="mb-3 text-2xl md:text-3xl font-bold tracking-tight text-foreground">{title}</h3>
        <p class="readable text-base leading-relaxed text-muted-foreground text-pretty">{description}</p>
      </div>
      <div class="flex flex-wrap gap-2.5">
        {year && <Chip size="md" variant="muted" class="bg-primary/10 text-primary border-primary/20">{year}</Chip>}
        {technologies.slice(0, 6).map((t) => (
          <Chip size="md" variant="muted">{t}</Chip>
        ))}
      </div>
      <div class="flex gap-3 pt-2">
        {demoLink && (
          <Button href={demoLink} target="_blank" rel="noopener noreferrer" size="lg" className="flex-1">
            View Case Study
          </Button>
        )}
        {githubRepo && (
          <Button variant="outline" href={githubRepo} target="_blank" rel="noopener noreferrer" size="lg">
            Source
          </Button>
        )}
      </div>
    </div>
  </div>
</section>

<script>
  import { inView, animate } from "motion";

  inView(".featured-project", (info: any) => {
      const target = info.target;
      const img = target.querySelector(".motion-image");
      const txt = target.querySelector(".motion-text");
      if(img) animate(img as any, { opacity: [0, 1], y: [20, 0], scale: [0.98, 1] }, { duration: 0.7, easing: [0.16, 1, 0.3, 1] } as any);
      if(txt) animate(txt as any, { opacity: [0, 1], y: [20, 0] }, { duration: 0.7, delay: 0.15, easing: [0.16, 1, 0.3, 1] } as any);
  });
</script>
