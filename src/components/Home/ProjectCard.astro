---
import SanityImage from '../shared/SanityImage.astro';

interface Props {
	title: string;
	description: string;
	license?: string;
	image: any;
	year?: string | number;
	technologies?: string[];
	tags?: string[];
	githubRepo?: string;
	demoLink?: string;
	index: number;
}

const {
	title,
	description,
	image,
	year,
	technologies = [],
	tags = [],
	githubRepo,
	demoLink,
} = Astro.props;

let primaryHref: string | null = null;
let secondaryHref: string | null = null;

if (demoLink && githubRepo) {
	primaryHref = demoLink;
	secondaryHref = githubRepo;
} else if (demoLink) {
	primaryHref = demoLink;
} else if (githubRepo) {
	primaryHref = githubRepo;
}
---

<article
  class="project-card group flex h-full flex-col border-2 border-border bg-card transition-all duration-300 hover:border-primary hover:-translate-y-1 hover:shadow-lg"
>
  <!-- Media -->
  <div class="relative w-full aspect-video border-b-2 border-border bg-secondary/5 overflow-hidden">
    <!-- Tech Grid Background -->
    <div class="absolute inset-0 bg-[radial-gradient(#000_1px,transparent_1px)] bg-size-[16px_16px] opacity-[0.03] dark:opacity-[0.1]"></div>
    
    <div class="relative h-full w-full p-8 flex items-center justify-center group-hover:scale-[1.02] transition-transform duration-500">
      {typeof image === "object" && image?.asset ? (
        <SanityImage asset={image.asset} alt={title} class="max-w-full max-h-full object-contain drop-shadow-none grayscale group-hover:grayscale-0 transition-all duration-500" />
      ) : image?.src ? (
        <img src={image.src} alt={title} class="max-w-full max-h-full object-contain drop-shadow-none grayscale group-hover:grayscale-0 transition-all duration-500" />
      ) : (
        <div class="flex flex-col items-center justify-center text-muted-foreground">
          <span class="text-4xl mb-2">âš¡</span>
          <span class="font-mono text-xs uppercase tracking-widest">No Preview</span>
        </div>
      )}
    </div>
  </div>

  <!-- Body -->
  <div class="flex flex-1 flex-col p-5 md:p-6 lg:p-7 xl:p-8">
    <div class="flex items-start justify-between gap-3 md:gap-4 mb-3 md:mb-4">
        <h3 class="text-xl md:text-2xl font-bold leading-none tracking-tight text-foreground group-hover:text-primary transition-colors uppercase">
          {title}
        </h3>
        {year && (
          <span class="shrink-0 text-xs font-mono font-bold text-primary border border-primary px-1.5 py-0.5">
              {year}
          </span>
        )}
    </div>

    {tags?.length > 0 && (
      <div class="flex flex-wrap gap-1.5 md:gap-2 mb-5 md:mb-6">
        {tags.slice(0, 3).map((tag) => (
          <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 border border-border bg-background text-muted-foreground">
            {tag}
          </span>
        ))}
      </div>
    )}
    
    <p class="text-muted-foreground leading-relaxed mb-6 md:mb-8 flex-1">
      {description}
    </p>
    
    <!-- Footer / Tech & Links -->
    <div class="mt-auto pt-5 md:pt-6 border-t-2 border-border flex items-center justify-between gap-3 md:gap-4">
        <div class="flex items-center gap-2 text-xs font-mono text-muted-foreground uppercase tracking-wider">
            <span class="truncate max-w-[120px] sm:max-w-[140px] md:max-w-[180px]" title={technologies.join(", ")}>
                {technologies.slice(0, 3).join(" / ")}{technologies.length > 3 ? "..." : ""}
            </span>
        </div>
        
        <div class="flex items-center gap-2.5 md:gap-3">
        {secondaryHref && (
                <a href={secondaryHref} target="_blank" rel="noopener noreferrer" class="flex items-center justify-center w-8 h-8 border border-border text-muted-foreground hover:bg-foreground hover:text-background hover:border-foreground transition-all duration-300 active:scale-95" aria-label="View source code on GitHub">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                </a>
            )}
            {primaryHref && (
                <a href={primaryHref} target="_blank" rel="noopener noreferrer" class="flex items-center justify-center w-8 h-8 border border-primary text-primary hover:bg-primary hover:text-primary-foreground transition-all duration-300 active:scale-95" aria-label="View live demo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                </a>
            )}
        </div>
    </div>
  </div>
</article>
